<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MedKit and PPE | Inventory System</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="globalLoader" style="display:none;">
        <div class="spinner"></div>
        <span>Loading...</span>
    </div>

    <nav class="nav-pane" id="mainNav">
        <div class="nav-container">
            <div class="brand">
                <h1>Medkit & PPE Inventory</h1>
            </div>
            <div id="authBar">
                <div id="lowStockAlert" class="alert-badge admin-only" title="Low Stock Items">üîî</div>
                <div id="expiryAlert" class="alert-badge admin-only" title="Expiring Items" style="display:none;">‚è∞</div>
                <div id="loginTrigger" class="avatar-circle" title="Admin Login">
                    <svg viewBox="0 0 24 24" width="35" height="35" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>

                <div id="employeeTrigger" class="avatar-circle admin-only" title="Employee Registration / Request">
                    <svg viewBox="0 0 24 24" width="39" height="33" fill="currentColor">
                        <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                    </svg>
                </div>

                <button id="logoutBtn" class="btn-danger" style="display:none;">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <h3>Admin Authentication</h3>
                <input type="email" id="adminEmail" placeholder="Email" autocomplete="email">
                <input type="password" id="adminPass" placeholder="Password" autocomplete="current-password">
                <div class="modal-btns">
                    <button id="loginBtn" class="btn-primary">Sign In</button>
                    <button id="closeModal" class="btn-text">Cancel</button>
                </div>
            </div>
        </div>

        <div id="lowStockModal" class="modal">
            <div class="modal-content">
                <h3>‚ö†Ô∏è Low Stock Items</h3>
                <ul id="lowStockList"></ul>
                <button id="closeLowStockModal" class="btn-primary">Close</button>
            </div>
        </div>
      
      <div id="employeeModal" class="modal">
          <div class="modal-content">
            <h3>üë• Employee Management</h3>
            <div class="admin-form-grid">
              <input type="hidden" id="editEmpId">
              <input type="text" id="empNameAdmin" placeholder="Employee Name">
              <input type="text" id="empIDAdmin" placeholder="Employee ID">
              <button id="saveEmpBtn" class="btn-primary">Add / Update</button>
            </div>
            <div class="table-scroll">
              <table id="employeeTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>ID</th>
                    <th class="admin-only" style="width: 110px;">Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <button id="closeEmployeeModal" class="btn-primary" style="margin-top: 15px; align-self: center;">Close</button>
          </div>
      </div>

        <div id="categoryModal" class="modal">
            <div class="modal-content" style="text-align: center;">
                <h3>üì¶ Select Category</h3>
                <p>Is this new item a Medkit or PPE?</p>
                <div class="modal-btns" style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                    <button id="chooseMedkit" class="btn-primary" style="background: #0ea5e9;">üíä Medkit Item</button>
                    <button id="choosePPE" class="btn-success">üõ°Ô∏è PPE Item</button>
                    <button id="cancelCategory" class="btn-text">Cancel</button>
                </div>
            </div>
        </div>

        <div id="expiryAlertModal" class="modal">
            <div class="modal-content">
                <h3 style="color: #dc2626;">‚ö†Ô∏è Expiring/Expired Items Alert</h3>
                <div id="expiryFilterTabs" style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <button class="filter-btn active" data-filter="expired">Expired</button>
                    <button class="filter-btn" data-filter="expiring">Expiring Soon</button>
                    <button class="filter-btn" data-filter="all">All Items</button>
                </div>
                <div id="expiryAlertList" style="max-height: 300px; overflow-y: auto;"></div>
                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <button id="printExpiryReport" class="btn-primary">üìÑ Print Report</button>
                    <button id="closeExpiryAlertModal" class="btn-text">Close</button>
                </div>
            </div>
        </div>

<div id="manualRequestModal" class="modal">
    <div class="modal-content">
        <h3>üìù Manual Request Entry</h3>
        <div class="admin-form-grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <input type="hidden" id="manualRequestId">
            <input type="text" id="manualReqName" placeholder="Full Name" style="grid-column: span 2;">
            <input type="text" id="manualReqID" placeholder="Employee ID">
            <input type="date" id="manualReqDate" placeholder="Request Date" max="">
            <select id="manualReqItem" style="grid-column: span 2;"></select>
            <input type="number" id="manualReqQty" placeholder="Quantity" min="1">
            <input type="text" id="manualReqStatus" placeholder="Status" value="Completed" readonly>
            <textarea id="manualReqPurpose" placeholder="Purpose..." style="grid-column: span 2;"></textarea>
        </div>
        <div class="modal-btns" style="margin-top: 20px; display: flex; gap: 10px;">
            <button id="saveManualRequestBtn" class="btn-success">Save Request</button>
            <button id="cancelManualRequestBtn" class="btn-text">Cancel</button>
        </div>
    </div>
</div>

<div id="excelImportModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <h3>üì• Import Inventory from Excel</h3>
        
        <div style="margin: 20px 0; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
            <h4 style="margin-top: 0; color: #3b82f6;">üìã Excel Format Requirements:</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <div style="padding: 10px; background: white; border-radius: 8px;">
                    <strong>Column A:</strong> Item Name
                </div>
                <div style="padding: 10px; background: white; border-radius: 8px;">
                    <strong>Column B:</strong> Quantity
                </div>
                <div style="padding: 10px; background: white; border-radius: 8px;">
                    <strong>Column C:</strong> Unit
                </div>
                <div style="padding: 10px; background: white; border-radius: 8px;">
                    <strong>Column D:</strong> Expiry Date
                </div>
                <div style="padding: 10px; background: white; border-radius: 8px; grid-column: span 2;">
                    <strong>Column E:</strong> Category (Medkit/PPE)
                </div>
            </div>
            <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #64748b;">
                ‚ìò First row should be headers. Expiry Date format: YYYY-MM-DD (optional for Medkit)
            </p>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" 
                   style="display: none;">
            <label for="excelFileInput" class="btn-primary" 
                   style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px 24px;">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
                </svg>
                Choose Excel File
            </label>
            <div id="fileName" style="margin-top: 10px; color: #64748b; font-size: 0.9rem;"></div>
        </div>
        
        <div id="previewTable" style="max-height: 400px; overflow-y: auto; margin: 20px 0; display: none; border: 1px solid #e2e8f0; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
                <thead>
                    <tr style="background: #f8fafc; position: sticky; top: 0;">
                        <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: left;">Item Name</th>
                        <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: center;">Quantity</th>
                        <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: center;">Unit</th>
                        <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: center;">Expiry</th>
                        <th style="padding: 12px; border: 1px solid #e2e8f0; text-align: center;">Category</th>
                    </tr>
                </thead>
                <tbody id="previewTableBody"></tbody>
            </table>
        </div>
        
        <div class="modal-btns" style="margin-top: 20px;">
            <button id="processImportBtn" class="btn-success" disabled>
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Import Items
            </button>
            <button id="cancelImportBtn" class="btn-text">Cancel</button>
        </div>
        
        <div id="importProgress" style="margin-top: 20px; display: none;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>Importing...</span>
                <span id="progressPercent">0%</span>
            </div>
            <div style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #22c55e, #16a34a); transition: width 0.3s;"></div>
            </div>
            <div id="importStatus" style="margin-top: 10px; font-size: 0.9rem; color: #64748b;"></div>
        </div>
    </div>
</div>

      <section class="card public-only" id="requestSection">
          <div class="card-header-flex">
              <h2 id="formTitle">Medkit Request Form</h2>
              <button id="formToggleBtn" class="btn-icon" title="Switch to PPE Request" aria-label="Toggle between Medkit and PPE request forms">
                  <span id="toggleIcon">üõ°Ô∏è</span>
                  <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.5-7.5-7.5-7.5L5 2l9 9-9 9z"/>
                  </svg>
              </button>
          </div>
          <div class="expiry-info" id="itemExpiryInfo" 
               style="font-size: 0.85rem; color: #64748b; padding: 8px 12px; 
                      background: rgba(59, 130, 246, 0.1); border-radius: 8px; 
                      margin-top: -10px; margin-bottom: 15px; display: none;">
              üìÖ Expiry Date: <span id="expiryDateDisplay"></span>
          </div>
          <div class="request-grid transition-fade" id="requestFields">
              <input type="text" id="reqName" placeholder="Full Name" aria-label="Full Name">
              <input type="text" id="reqID" placeholder="Employee ID" aria-label="Employee ID">
              <select id="reqItemSelect" aria-label="Select Item"></select>
              <input type="number" id="reqQty" placeholder="Qty" min="1" aria-label="Quantity">
              <textarea id="reqPurpose" placeholder="Purpose for request..." aria-label="Purpose for request"></textarea>
              <button id="reqBtn" class="btn-success">Submit Request</button>
          </div>
      </section>
      
        <section class="card admin-only">
            <h2>‚öôÔ∏è Inventory Management</h2>
            <div class="admin-form-grid">
                <input type="hidden" id="editItemId">
                <input type="text" id="itemName" placeholder="Item Name" aria-label="Item Name">
                <input type="number" id="itemQty" placeholder="Quantity" aria-label="Quantity">
                <select id="itemUnit" aria-label="Unit of Measurement">
                    <option value="Pc">Piece (Pc)</option>
                    <option value="Tablet">Tablet</option>
                    <option value="ml">ml</option>
                    <option value="Box">Box</option>
                    <option value="Bottle">Bottle</option>
                    <option value="Pack">Pack</option>
                    <option value="Pair">Pair</option>
                    <option value="Set">Set</option>
                    <option value="Vial">Vial</option>
                    <option value="Tube">Tube</option>
                    <option value="Can">Can</option>
                    <option value="Carton">Carton</option>
                </select>
                <input type="date" id="itemExpiry" placeholder="Expiry Date (Optional)" 
                       aria-label="Expiry Date (Optional for Medkit items)" 
                       min="">
                <button id="saveBtn" class="btn-primary">Add / Update</button>
            </div>
            <div class="form-note" style="font-size: 0.85rem; color: #64748b; margin-top: 8px;">
                ‚ìò Expiry date is only applicable for Medkit items
            </div>
            
            <div class="admin-form-grid" style="margin-top: 20px;">
                <button id="importExcelBtn" class="btn-success" style="grid-column: span 2;">
                    üì• Import from Excel
                </button>
            </div>
        </section>

       <section class="card">
          <div class="card-header-flex">
            <h2>üì¶ Current Stock</h2>
            <div class="filter-buttons admin-only">
              <button id="filterAllBtn" class="filter-btn filter-all active">All Items</button>
              <button id="filterMedkitBtn" class="filter-btn filter-medkit">Medkit Only</button>
              <button id="filterPPEBtn" class="filter-btn filter-ppe">PPE Only</button>
            </div>
            <div class="admin-only" style="display: flex; gap: 10px;">
                <button id="downloadStockBtn" class="btn-success" style="padding: 8px 16px; font-size: 14px;">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    Export
                </button>
            </div>
          </div>
          
          <div class="table-container" style="position: relative;">
            <div class="table-scroll" style="max-height: 500px; overflow-y: auto; overflow-x: auto;">
                <table id="inventoryTable" aria-label="Inventory Table">
                <thead style="position: sticky; top: 0; z-index: 10; background: rgba(59, 130, 246, 0.1);">
                    <tr>
                    <th style="width: 40%; min-width: 200px; text-align: left; position: sticky; left: 0; background: inherit; z-index: 11;">DESCRIPTION</th>
                    <th style="width: 20%; min-width: 120px; text-align: center;">LEVEL</th>
                    <th style="width: 15%; min-width: 100px; text-align: center;">EXPIRY</th>
                    <th style="width: 15%; min-width: 150px; text-align: center;" class="admin-only">ACTIONS</th>
                    </tr>
                </thead>
                <tbody id="inventoryBody"></tbody>
                </table>
            </div>
            
            <div id="stockSummary" style="margin-top: 15px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-radius: 8px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>Total Items:</strong> <span id="totalItems">0</span> | 
                        <strong>Total Quantity:</strong> <span id="totalQuantity">0</span> |
                        <strong>Low Stock:</strong> <span id="lowStockCount">0</span>
                    </div>
                    <button id="clearStockFilter" class="btn-text" style="font-size: 12px;">Clear Filters</button>
                </div>
            </div>
            
            <div id="emptyStockMessage" style="display: none; text-align: center; padding: 40px 20px; color: #64748b;">
                <svg width="48" height="48" fill="currentColor" viewBox="0 0 24 24" style="opacity: 0.5;">
                    <path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/>
                </svg>
                <h4 style="margin: 16px 0 8px 0;">No inventory items found</h4>
                <p>Add items using the form above or import from Excel</p>
                <button id="addFirstItemBtn" class="btn-primary" style="margin-top: 16px;">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Add Your First Item
                </button>
            </div>
          </div>
        </section>

        <section class="card admin-only">
            <h2>üìä Logs</h2>
            <div class="logs-controls">
                <div class="logs-filter-group">
                    <label for="logTypeSelect" class="logs-filter-label">Log Type:</label>
                    <select id="logTypeSelect">
                        <option value="requests">Requests</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="logs-filter-group">
                    <label for="logFilterMonth" class="logs-filter-label">Filter Month:</label>
                    <input type="month" id="logFilterMonth">
                </div>
                <button id="addManualRequestBtn" class="btn-success" style="display: none;">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="margin-right: 6px;">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Manual Request
                </button>
                <button id="downloadCsvBtn" class="btn-success">Export CSV</button>
            </div>
            <div id="reportTableContainer" class="table-scroll"></div>
        </section>
    </div>
    <script type="module" src="app.js"></script>
</body>
</html>
